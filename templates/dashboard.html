<!DOCTYPE html>
<html>
<head>
  <title>Test Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #3498db;
      --success-color: #2ecc71;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
    }
    
    body {
      background-color: #f9f9f9;
      color: var(--dark-color);
    }
    
    .container {
      max-width: 1200px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      padding: 30px;
    }
    
    .dashboard-header {
      border-bottom: 2px solid var(--light-color);
      margin-bottom: 2rem;
      padding-bottom: 1rem;
    }
    
    .card {
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      border: none;
    }
    
    .card-header {
      background-color: var(--primary-color);
      color: white;
      font-weight: bold;
      border-radius: 8px 8px 0 0 !important;
      padding: 15px 20px;
    }
    
    .chart-container {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    /* ì°¨íŠ¸ ì˜ì—­ ìŠ¤íƒ€ì¼ ê°œì„  */
    .position-relative {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .position-absolute {
      animation: scaleIn 0.8s ease-in-out;
    }
    
    @keyframes scaleIn {
      from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    .test-summary {
      background-color: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--primary-color);
      animation: slideIn 0.6s ease-in-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .status-badge {
      font-weight: bold;
      padding: 0.4em 0.8em;
      border-radius: 20px;
      font-size: 0.85rem;
    }
    
    .btn {
      border-radius: 6px;
      font-weight: 500;
      padding: 0.5rem 1rem;
      transition: all 0.3s;
    }
    
    .btn-sm {
      font-size: 0.85rem;
      padding: 0.25rem 0.5rem;
    }
    
    .action-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      margin: 2px;
      min-width: 80px;
    }
    
    .table {
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .table th {
      background-color: var(--dark-color);
      color: white;
      border: none;
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.85rem;
      padding: 12px 15px;
    }
    
    .table td {
      padding: 12px 15px;
      vertical-align: middle;
    }
    
    .filter-control {
      border-radius: 8px;
      background-color: white;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
    }
    
    .filter-btn, .sort-btn {
      border-radius: 20px;
      padding: 0.5rem 1rem;
    }
    
    .filter-btn.active, .sort-btn.active {
      font-weight: bold;
    }
    
    .loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      border-radius: 8px;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
    }
    
    .section-title {
      position: relative;
      padding-left: 15px;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    
    .section-title::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 5px;
      background-color: var(--primary-color);
      border-radius: 3px;
    }
    
    .stats-card {
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      background-color: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .success-rate-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: conic-gradient(var(--success-color) 0%, var(--success-color) var(--rate), var(--light-color) var(--rate), var(--light-color) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
    }
    
    .inner-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .search-input {
      border-radius: 20px 0 0 20px;
      padding-left: 15px;
    }
    
    .search-btn {
      border-radius: 0 20px 20px 0;
      background-color: var(--primary-color);
      color: white;
      padding: 0.5rem 1.5rem;
    }
    
    .search-btn:hover {
      background-color: #2980b9;
      color: white;
    }
    
    /* í…Œì´ë¸” í–‰ ìŠ¤íƒ€ì¼ */
    .table-success td {
      background-color: rgba(46, 204, 113, 0.1) !important;
    }
    
    .table-danger td {
      background-color: rgba(231, 76, 60, 0.1) !important;
    }
  </style>
</head>
<body>
<div class="container py-5">

  <div class="dashboard-header">
    <h1 class="mb-3"><i class="fas fa-chart-line me-2"></i> Test Dashboard</h1>
    <p class="text-muted">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼ì™€ ì„±ê³µë¥  í†µê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
  </div>

  <div class="row mb-4">
    <div class="col-md-8">
      <!-- ì°¨íŠ¸ -->
      <div class="chart-container">
        <h5 class="mb-3 section-title">ì„±ê³µ/ì‹¤íŒ¨ ë¹„ìœ¨</h5>
        <div class="row">
          <div class="col-md-6 d-flex justify-content-center align-items-center">
            <div class="position-relative">
              <canvas id="reportChart" style="max-width: 300px; max-height: 300px;"></canvas>
              <!-- ì°¨íŠ¸ ì¤‘ì•™ì— ì„±ê³µë¥  í‘œì‹œ -->
              <div class="position-absolute top-50 start-50 translate-middle text-center">
                <h3 id="success-rate-center" class="mb-0 fw-bold">
                  {% if values[0] + values[1] > 0 %}
                    {% set success_rate = (values[1] / (values[0] + values[1]) * 100) | round | int %}
                    {{ success_rate }}%
                  {% else %}
                    0%
                  {% endif %}
                </h3>
                <small class="text-muted">ì„±ê³µë¥ </small>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="test-summary p-3">
              <h6 class="fw-bold mb-3">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ìš”ì•½</h6>
              <div class="d-flex justify-content-between mb-2">
                <div class="text-muted">ì´ ì‹¤í–‰ íšŸìˆ˜:</div>
                <div class="fw-bold">{{ values[0] + values[1] }}íšŒ</div>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <div class="text-success">
                  <i class="fas fa-check-circle me-1"></i> ì„±ê³µ:
                </div>
                <div class="fw-bold text-success">{{ values[1] }}íšŒ</div>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <div class="text-danger">
                  <i class="fas fa-times-circle me-1"></i> ì‹¤íŒ¨:
                </div>
                <div class="fw-bold text-danger">{{ values[0] }}íšŒ</div>
              </div>
              <hr class="my-3">
              <div class="progress" style="height: 8px;">
                {% if values[0] + values[1] > 0 %}
                  {% set progress_width = (values[1] / (values[0] + values[1]) * 100) | round | int %}
                {% else %}
                  {% set progress_width = 0 %}
                {% endif %}
                <div class="progress-bar bg-success" role="progressbar" 
                     style="width: {{ progress_width }}%;" 
                     aria-valuenow="{{ progress_width }}" 
                     aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <div class="d-flex justify-content-between mt-2">
                <div class="small text-muted">ê°€ì¥ ìµœê·¼ ì‹¤í–‰:</div>
                <div class="small">{{ reports[0].timestamp if reports else 'ì—†ìŒ' }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <!-- í‰ê·  ì‹¤í–‰ ì‹œê°„ -->
      <div class="stats-card">
        <h5 class="text-muted mb-3"><i class="fas fa-clock me-2"></i> í‰ê·  ì‹¤í–‰ ì‹œê°„</h5>
        <h2><span id="avg-duration">{{ avg_duration }}</span> ì´ˆ</h2>
      </div>
      
      <!-- í…ŒìŠ¤íŠ¸ ì„±ëŠ¥ ì§€í‘œ ì¶”ê°€ -->
      <div class="stats-card">
        <h5 class="text-muted mb-3"><i class="fas fa-tachometer-alt me-2"></i> í…ŒìŠ¤íŠ¸ ì„±ëŠ¥</h5>
        <div class="d-flex justify-content-between mb-2">
          <div>ê°€ì¥ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸:</div>
          <div class="fw-bold">
            {% if reports %}
              {% set min_duration = 9999 %}
              {% for report in reports %}
                {% if report.duration is defined and report.duration < min_duration %}
                  {% set min_duration = report.duration %}
                {% endif %}
              {% endfor %}
              {{ min_duration if min_duration != 9999 else 0 }} ì´ˆ
            {% else %}
              0 ì´ˆ
            {% endif %}
          </div>
        </div>
        <div class="d-flex justify-content-between">
          <div>ê°€ì¥ ëŠë¦° í…ŒìŠ¤íŠ¸:</div>
          <div class="fw-bold">
            {% if reports %}
              {% set max_duration = 0 %}
              {% for report in reports %}
                {% if report.duration is defined and report.duration > max_duration %}
                  {% set max_duration = report.duration %}
                {% endif %}
              {% endfor %}
              {{ max_duration }} ì´ˆ
            {% else %}
              0 ì´ˆ
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- í•„í„° ì»¨íŠ¸ë¡¤ ëª¨ë°”ì¼ìš© -->
      <div class="stats-card d-md-none">
        <h5 class="text-muted mb-3"><i class="fas fa-filter me-2"></i> í•„í„°</h5>
        <div class="d-flex flex-wrap gap-2 mb-2">
          <button type="button" class="btn filter-btn {% if status_filter == 'PASS' %}btn-success{% else %}btn-outline-success{% endif %}" data-filter="PASS">
            <i class="fas fa-check-circle me-1"></i> PASS
          </button>
          <button type="button" class="btn filter-btn {% if status_filter == 'FAIL' %}btn-danger{% else %}btn-outline-danger{% endif %}" data-filter="FAIL">
            <i class="fas fa-times-circle me-1"></i> FAIL
          </button>
          <button type="button" class="btn filter-btn {% if not status_filter %}btn-dark{% else %}btn-outline-dark{% endif %}" data-filter="">
            <i class="fas fa-list me-1"></i> ì „ì²´
          </button>
        </div>
        <div class="btn-group w-100 mt-2">
          <button type="button" class="btn sort-btn {% if sort_order == 'desc' %}btn-primary{% else %}btn-outline-primary{% endif %}" data-sort="desc">
            <i class="fas fa-sort-amount-down me-1"></i> ìµœì‹ ìˆœ
          </button>
          <button type="button" class="btn sort-btn {% if sort_order == 'asc' %}btn-primary{% else %}btn-outline-primary{% endif %}" data-sort="asc">
            <i class="fas fa-sort-amount-up me-1"></i> ì˜¤ë˜ëœìˆœ
          </button>
        </div>
      </div>
    </div>
  </div>

  
  <!-- í…ŒìŠ¤íŠ¸ ì„±ê³µë¥  í†µê³„ -->
  <div class="card">
    <div class="card-header">
      <i class="fas fa-chart-bar me-2"></i> í…ŒìŠ¤íŠ¸ ì„±ê³µë¥  í†µê³„
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
    <tr>
      <th>Test Case</th>
              <th class="text-center">ì‹¤í–‰ íšŸìˆ˜</th>
              <th class="text-center">PASS</th>
              <th class="text-center">FAIL</th>
              <th class="text-center">ì„±ê³µë¥ </th>
              <th class="text-center">ìµœê·¼ ì‹¤í–‰</th>
    </tr>
  </thead>
  <tbody>
    {% for stat in test_case_stats %}
    <tr>
      <td>{{ stat.test_case }}</td>
              <td class="text-center">{{ stat.run_count }}</td>
              <td class="text-center text-success">{{ stat.pass_count }}</td>
              <td class="text-center text-danger">{{ stat.fail_count }}</td>
              <td class="text-center">
                <div class="d-flex align-items-center justify-content-center">
                  <div class="success-rate-circle" style="--rate: {{ stat.success_rate }}%">
                    <div class="inner-circle">{{ stat.success_rate }}%</div>
                  </div>
                </div>
              </td>
              <td class="text-center">{{ stat.last_run }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
      </div>
    </div>
  </div>

  <!-- ê²€ìƒ‰ ë° í•„í„° -->
  <div class="filter-control d-none d-md-block" id="filter-controls">
    <div class="row align-items-center">
      <div class="col-md-5">
        <div class="input-group">
          <input type="text" class="form-control search-input" id="search-input" placeholder="ğŸ” í…ŒìŠ¤íŠ¸ ì´ë¦„ ë˜ëŠ” ì„¤ëª… ê²€ìƒ‰" value="{{ keyword or '' }}">
          <button class="btn search-btn" id="search-btn"><i class="fas fa-search"></i> ê²€ìƒ‰</button>
        </div>
      </div>
      <div class="col-md-7 text-end">
        <div class="btn-group me-2" role="group">
          <button type="button" class="btn filter-btn {% if status_filter == 'PASS' %}btn-success{% else %}btn-outline-success{% endif %}" data-filter="PASS">
            <i class="fas fa-check-circle me-1"></i> PASS
          </button>
          <button type="button" class="btn filter-btn {% if status_filter == 'FAIL' %}btn-danger{% else %}btn-outline-danger{% endif %}" data-filter="FAIL">
            <i class="fas fa-times-circle me-1"></i> FAIL
          </button>
          <button type="button" class="btn filter-btn {% if not status_filter %}btn-dark{% else %}btn-outline-dark{% endif %}" data-filter="">
            <i class="fas fa-list me-1"></i> ì „ì²´
          </button>
      </div>

      <div class="btn-group" role="group">
          <button type="button" class="btn sort-btn {% if sort_order == 'desc' %}btn-primary{% else %}btn-outline-primary{% endif %}" data-sort="desc">
            <i class="fas fa-sort-amount-down me-1"></i> ìµœì‹ ìˆœ
          </button>
          <button type="button" class="btn sort-btn {% if sort_order == 'asc' %}btn-primary{% else %}btn-outline-primary{% endif %}" data-sort="asc">
            <i class="fas fa-sort-amount-up me-1"></i> ì˜¤ë˜ëœìˆœ
          </button>
        </div>
      </div>
    </div>
  </div>

  
  <!-- ìµœê·¼ ì‹¤í–‰ ê²°ê³¼ -->
  <div id="reports-container" class="card mt-4 position-relative">
    <div class="card-header">
      <i class="fas fa-clipboard-list me-2"></i> ìµœê·¼ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼
    </div>
    <div class="card-body p-0">
      <div id="reports-content">
        {% if reports %}
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th class="text-center">ID</th>
        <th>Test Case</th>
        <th>Description</th>
                <th class="text-center">Status</th>
                <th class="text-center">Time</th>
                <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for report in reports %}
              <tr class="{% if report.status == 'FAIL' %}table-danger{% else %}table-success{% endif %}">
                <td class="text-center fw-bold">{{ report.id }}</td>
                <td>{{ report.test_case }}</td>
                <td>{{ report.description }}</td>
                <td class="text-center">
                  <span class="badge status-badge {% if report.status == 'PASS' %}bg-success{% else %}bg-danger{% endif %}">
                    <i class="fas {% if report.status == 'PASS' %}fa-check-circle{% else %}fa-times-circle{% endif %} me-1"></i>
                    {{ report.status }}
                  </span>
                </td>
                <td class="text-center">{{ report.timestamp }}</td>
        <td class="text-center">
                  <a href="{{ url_for('view_report', report_id=report.id) }}" class="btn btn-sm btn-primary action-btn">
                    <i class="fas fa-eye"></i> ìƒì„¸
                  </a>
                  <form method="post" action="{{ url_for('delete_report', report_id=report.id) }}" style="display:inline;" class="delete-form">
                    <button type="submit" class="btn btn-sm btn-danger action-btn delete-btn" data-id="{{ report.id }}">
                      <i class="fas fa-trash"></i> ì‚­ì œ
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
        </div>
        {% else %}
        <div class="alert alert-info m-3">
          <i class="fas fa-info-circle me-2"></i> ì•„ì§ ì‹¤í–‰ëœ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•´ë³´ì„¸ìš”.
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="text-center mt-4">
    <a href="/" class="btn btn-dark">
      <i class="fas fa-home me-1"></i> í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </a>
  </div>

  <script>
    function initChart(labels, values) {
      const ctx = document.getElementById('reportChart').getContext('2d');
      if (window.testChart) {
        window.testChart.destroy();
      }
      
      // ì„±ê³µë¥ ê³¼ ì´ ì‹¤í–‰ ê³„ì‚°
      const totalRuns = values.reduce((a, b) => a + b, 0);
      const successRate = totalRuns > 0 ? Math.round((values[1] / totalRuns) * 100) : 0;
      
      // ì°¨íŠ¸ ì¤‘ì•™ ì„±ê³µë¥  ì—…ë°ì´íŠ¸
      document.getElementById('success-rate-center').textContent = `${successRate}%`;
      
      // í…ŒìŠ¤íŠ¸ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
      document.querySelector('.test-summary .fw-bold:nth-of-type(1)').textContent = `${totalRuns}íšŒ`;
      document.querySelector('.test-summary .text-success + .fw-bold').textContent = `${values[1]}íšŒ`;
      document.querySelector('.test-summary .text-danger + .fw-bold').textContent = `${values[0]}íšŒ`;
      
      // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸
      const progressBar = document.querySelector('.progress-bar');
      progressBar.style.width = `${successRate}%`;
      progressBar.setAttribute('aria-valuenow', successRate);
      
      window.testChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            label: 'Test Results',
            data: values,
            borderWidth: 1,
            backgroundColor: ['#e74c3c', '#2ecc71'], // FAIL, PASS
            borderColor: ['#c0392b', '#27ae60'],
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          cutout: '70%', // ë„ë„› ë‘ê»˜ ì¡°ì •
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                font: {
                  size: 12
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label;
                  const value = context.raw;
                  const percent = totalRuns > 0 ? Math.round((value / totalRuns) * 100) : 0;
                  if (label === 'PASS') return `ì„±ê³µ íšŸìˆ˜: ${value} (${percent}%)`;
                  if (label === 'FAIL') return `ì‹¤íŒ¨ íšŸìˆ˜: ${value} (${percent}%)`;
                  return `${label}: ${value}`;
                }
              }
            }
          }
        }
      });
    }

    // ì´ˆê¸° ì°¨íŠ¸ ì„¤ì •
    $(document).ready(function() {
      // í…œí”Œë¦¿ ê°’ì„ JavaScript ë³€ìˆ˜ë¡œ ì•ˆì „í•˜ê²Œ ì „ë‹¬
      const chartLabels = {{ labels|tojson|safe }};
      const chartValues = {{ values|tojson|safe }};
      
      // Jinja2 í…œí”Œë¦¿ ë³€ìˆ˜ë“¤ì„ ì•ˆì „í•˜ê²Œ JavaScript ë³€ìˆ˜ë¡œ ë³€í™˜
      const statusFilter = '{{ status_filter or "" }}';
      const sortOrder = '{{ sort_order or "desc" }}';
      const keywordSearch = '{{ keyword or "" }}';
      
      // ì°¨íŠ¸ ì´ˆê¸°í™” í˜¸ì¶œ
      initChart(chartLabels, chartValues);
    
      let currentFilter = statusFilter;
      let currentSort = sortOrder;
      let currentSearch = keywordSearch;

      // AJAX ë¡œë“œ í•¨ìˆ˜
      function loadReports() {
        $('#reports-container').append('<div class="loading"><div class="spinner-border text-primary loading-spinner" role="status"></div></div>');
        
        $.ajax({
          url: '/api/reports',
          type: 'GET',
          data: {
            status: currentFilter,
            sort: currentSort,
            q: currentSearch
          },
          success: function(data) {
            $('#reports-content').html(data.html);
            $('#avg-duration').text(data.avg_duration);
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            initChart(data.chart.labels, data.chart.values);
            
            // ìµœê·¼ ì‹¤í–‰ ì‹œê°„ ì—…ë°ì´íŠ¸
            if (data.reports && data.reports.length > 0) {
              $('.test-summary .small:last').text(data.reports[0].timestamp);
            }
            
            // í…ŒìŠ¤íŠ¸ ì„±ëŠ¥ ì§€í‘œ ì—…ë°ì´íŠ¸ (í•„ìš” ì‹œ)
            updatePerformanceMetrics(data.reports);
          },
          error: function() {
            alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          },
          complete: function() {
            $('.loading').remove();
          }
        });
      }
      
      // í…ŒìŠ¤íŠ¸ ì„±ëŠ¥ ì§€í‘œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updatePerformanceMetrics(reports) {
        if (!reports || reports.length === 0) return;
        
        // ì‹¤í–‰ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ìµœì†Œ/ìµœëŒ€ ì°¾ê¸°
        let minDuration = Infinity;
        let maxDuration = 0;
        
        reports.forEach(report => {
          const duration = report.duration || 0;
          if (duration < minDuration) minDuration = duration;
          if (duration > maxDuration) maxDuration = duration;
        });
        
        // ì„±ëŠ¥ ì¹´ë“œ ì—…ë°ì´íŠ¸
        const perfCard = document.querySelector('.stats-card:nth-of-type(2)');
        if (perfCard) {
          const minElement = perfCard.querySelector('.d-flex:nth-of-type(1) .fw-bold');
          const maxElement = perfCard.querySelector('.d-flex:nth-of-type(2) .fw-bold');
          
          if (minElement) minElement.textContent = `${minDuration === Infinity ? 0 : minDuration} ì´ˆ`;
          if (maxElement) maxElement.textContent = `${maxDuration} ì´ˆ`;
        }
      }

      // í•„í„° ë²„íŠ¼ í´ë¦­
      $('.filter-btn').click(function() {
        $('.filter-btn').removeClass('btn-success btn-danger btn-dark').addClass(function() {
          const filter = $(this).data('filter');
          if (filter === 'PASS') return 'btn-outline-success';
          if (filter === 'FAIL') return 'btn-outline-danger';
          return 'btn-outline-dark';
        });
        
        const filter = $(this).data('filter');
        $(this).removeClass(function() {
          if (filter === 'PASS') return 'btn-outline-success';
          if (filter === 'FAIL') return 'btn-outline-danger';
          return 'btn-outline-dark';
        }).addClass(function() {
          if (filter === 'PASS') return 'btn-success';
          if (filter === 'FAIL') return 'btn-danger';
          return 'btn-dark';
        });
        
        currentFilter = filter;
        loadReports();
      });

      // ì •ë ¬ ë²„íŠ¼ í´ë¦­
      $('.sort-btn').click(function() {
        $('.sort-btn').removeClass('btn-primary').addClass('btn-outline-primary');
        $(this).removeClass('btn-outline-primary').addClass('btn-primary');
        currentSort = $(this).data('sort');
        loadReports();
      });

      // ê²€ìƒ‰ ê¸°ëŠ¥
      $('#search-btn').click(function() {
        currentSearch = $('#search-input').val();
        loadReports();
      });

      // ì—”í„° í‚¤ë¡œ ê²€ìƒ‰
      $('#search-input').keypress(function(e) {
        if(e.which === 13) {
          currentSearch = $(this).val();
          loadReports();
        }
      });

      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ìœ„ì„
      $(document).on('click', '.delete-btn', function(e) {
        e.preventDefault();
        if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          const id = $(this).data('id');
          const form = $(this).closest('form');
          
          $.ajax({
            url: form.attr('action'),
            type: 'POST',
            success: function() {
              loadReports(); // ì‚­ì œ í›„ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
            },
            error: function() {
              alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
          });
        }
      });
    });
  </script>
</div>
</body>
</html>